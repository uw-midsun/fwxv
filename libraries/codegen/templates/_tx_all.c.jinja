{% set messages = data["Messages"] -%}
{% set board = data["Board"] -%}

#include <stdint.h>

#include "can_board_ids.h"
#include "can_codegen.h"
#include "can_pack_impl.h"

void can_tx_all() {
    CanMessage msg = { 0 };
{%- for message, message_data in messages.items() %}
    {%- set signals = message_data["signals"].keys() %}
    can_pack_impl_u64(
        &msg, SYSTEM_CAN_MESSAGE_{{data["Board"] | upper}}_{{message | upper}}, 
        {{- message_data['signals'].values() | sum(attribute='length') }},
    {%- set offset = namespace(value=64) %}
    {%- for signal, signal_data in message_data['signals'].items() %}
        {%- set offset.value = offset.value - signal_data.length %}
        (uint64_t) g_tx_struct.{{message}}_{{signal}} << {{offset.value}} &
    {%- endfor -%}
        0
    );
    can_transmit(&msg);
{%- endfor %}
}
